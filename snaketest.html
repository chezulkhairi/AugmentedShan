<!doctype html>
<html>
	<head>
		
		<script src="promise-6.0.0.min.js"></script>
		<script src="jsfeat/build/jsfeat.js"></script>
		<script src="numeric-1.2.6.min.js"></script>
		<script src="sylvester.js"></script>
		<script src="math.min.js"></script>
		<script src="dat.gui.min.js"></script>
		<script src="three.min.js"></script>
		<script src="multiline.js"></script>

		<script>
			//<script src="//localhost:3000/socket.io/socket.io.js">< /script>

			var socketAddr = location.host.split(':')[0] + ':3000';
			var socketScript = document.createElement('script')
			socketScript.setAttribute("type","text/javascript")
			socketScript.setAttribute("src", '//'+socketAddr+'/socket.io/socket.io.js');
			document.getElementsByTagName('head')[0].appendChild(socketScript);

			window.addEventListener('load',function(){
				var socket = io(socketAddr+'/snake');
				var canvas = document.getElementById('playCanvas');
				var ctx = canvas.getContext('2d');

				window.addEventListener('keydown',function(e){
					var event = window.event ? window.event : e;
					if(event.keyCode == 37){
						socket.emit('move','left');
					}else if(event.keyCode == 38){
						socket.emit('move','up');
					}else if(event.keyCode == 39){
						socket.emit('move','right');
					}else if(event.keyCode == 40){
						socket.emit('move','down');
					}
				});

				socket.on('connect',function(){
					socket.emit('join');
				})
				socket.on('configure',function(info){
					console.log(info);
				});
				socket.on('update',function(state){
					console.log(state);
					ctx.clearRect(0,0,canvas.width,canvas.height);
					var dx = canvas.width/52;
					var dy = canvas.height/34;


					ctx.strokeStyle = 'black';
					ctx.strokeRect(0,0,canvas.width,canvas.height);
					ctx.fillStyle = 'gray';
					var blocks = [
						{x:16,y:7},
						{x:35,y:7},
						{x:12,y:22},
						{x:31,y:22}
					];
					for (var i = 0; i < blocks.length; i++) {
						ctx.fillRect(dx*blocks[i].x,dy*blocks[i].y,dx*10,dy*8);
					};
					for (var i = 0; i < state.deadParts.length; i++) {
						var dp = state.deadParts[i];
						ctx.fillRect(dx*dp.x,dy*dp.y,dx,dy);
					};


					ctx.fillStyle = 'black';
					ctx.fillRect(dx*(state.food.x+0.25),dy*(state.food.y+0.25),dx*.5,dy*.5);

					for (var i = 0; i < state.snakes.length; i++) {
						snake = state.snakes[i];
						ctx.fillStyle = hsv2rgb({hue:Math.floor(53.2957795130824*snake.id)%360,sat:1,val:1});
						for (var j = 0; j < snake.parts.length; j++) {
							var part = snake.parts[j];
							ctx.fillRect(dx*part.x, dy*part.y, dx, dy);
						};
					};
				});
			})
var hsv2rgb = function(hsv) {
  var h = hsv.hue, s = hsv.sat, v = hsv.val;
  var rgb, i, data = [];
  if (s === 0) {
    rgb = [v,v,v];
  } else {
    h = h / 60;
    i = Math.floor(h);
    data = [v*(1-s), v*(1-s*(h-i)), v*(1-s*(1-(h-i)))];
    switch(i) {
      case 0:
        rgb = [v, data[2], data[0]];
        break;
      case 1:
        rgb = [data[1], v, data[0]];
        break;
      case 2:
        rgb = [data[0], v, data[2]];
        break;
      case 3:
        rgb = [data[0], data[1], v];
        break;
      case 4:
        rgb = [data[2], data[0], v];
        break;
      default:
        rgb = [v, data[0], data[1]];
        break;
    }
  }
  return '#' + rgb.map(function(x){ 
    return ("0" + Math.round(x*255).toString(16)).slice(-2);
  }).join('');
};
		</script>
	</head>
	<body>
		<canvas id="playCanvas" width="640" height="360"></canvas>
	</body>
</html>
